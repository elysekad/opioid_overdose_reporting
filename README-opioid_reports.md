# Parameterized reports for reporting suspect drug overdoses by county

The scripts in this repository generate a county-specific html report characterizing ED visits due to all drug, opioid, heroin, and non-heroin overdoses for each county in Washington State that have ≥75% of ED's within their county sending data to the National Syndromic Surveillance Program's (NSSP) production environment. Suspected overdoses are detected in the data by querying the contents of chief complaint and discharge diagnosis using ESSENCE Chief Complaint Discharge Diagnosis (CCDD) categories. Since these are not confirmed by lab results, counts in this report may differ from the true value. The timeframe of data for each report is from the first to the last quarters for which data is complete for ≥75% of EDs in that county.

## Getting Started

### File descriptions

* active_counties - example of what the active_counties csv output
* prod_date - example of what the prod_date csv output
* creating_params_render_reports.R - file that pulls data and renders reports
* county_od_report.Rmd - this file is called to render the county specific report 
* anonymized_report.html - example of county report output

### Prerequisites

In order to run this script, you will need an ESSENCE account with access to line level data for all of the counties in Washington State. If you do not have an account or have questions about your account permissions, please e-mail syndromic.surveillance@doh.wa.gov. These scripts will need to be run on RStudio Server on the BioSense platform. They pull data from the BioSense_Platform database which cannot be accessed from a local machine.    

### Set up

Upload both scripts to RStudio Server. You will also want to come up with a file naming convention for how you would like the data pulled for the report and the generated html reports to be saved every time you run thse reports (eg "Q4-2018", "Q1-2019", etc).  

## Running the reports

The reports are generated by running the "creating_params_render_reports.R" file. Only information at the top of the script within the hashtag lines needs to be changed. Information that needs to be entered is:

* ESSENCE username
* ESSENCE password
* File path where you would like data and reports to be saved
* File path where the "County_od_report.Rmd" is saved
* First date of first quarter to be pulled
* last date of most recent quarter 
* Four digit ESSENCE user_id 

The script will pull the WA_MFT table from the BioSense_platform and calculate which counties have ≥75% of ED's reporting to NSSP prod and the quarter where they reached the ≥75% threshold. This information is saved as a csv named "active_counties.csv" in the file path specified in a folder named "data". It also creates a csv file of facility names and dates that they were accepted to send to NSSP prod. This file is named "prod_date.csv" and saved in the same "data" folder as the active counties csv. Both of these files will be used to generate some of the tables in the county reports.   

The script iterates over the county code, start date, and end date for each row in the "active_counties" to generate the county-specific reports. 